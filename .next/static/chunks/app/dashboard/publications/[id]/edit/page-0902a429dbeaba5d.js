(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9838],{14636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>n,Wv:()=>o,hl:()=>c});var s=a(95155),r=a(12115),l=a(20547),i=a(59434);let n=l.bL,o=l.l9;l.Mz;let c=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:n=4,...o}=e;return(0,s.jsx)(l.ZL,{children:(0,s.jsx)(l.UC,{ref:t,align:r,sideOffset:n,className:(0,i.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...o})})});c.displayName=l.UC.displayName},89328:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>E});var s=a(95155),r=a(12115),l=a(35695),i=a(62177),n=a(90221),o=a(55594),c=a(12543),d=a(21887),h=a(10518),u=a(18046),x=a(56671),m=a(30285),j=a(17759),p=a(62523),g=a(88539),f=a(59409),v=a(17972),y=a(14636),b=a(26126),w=a(66695),C=a(59434);let N=o.Ik({title:o.Yj().min(3,"Title must be at least 3 characters").max(100,"Title must be less than 100 characters"),description:o.Yj().min(10,"Description must be at least 10 characters").max(500,"Description must be less than 500 characters"),content:o.Yj().min(50,"Content must be at least 50 characters"),status:o.k5(["DRAFT","PUBLISHED","ARCHIVED"],{required_error:"Please select a status"}),category:o.Yj().min(1,"Category is required"),tags:o.YO(o.Yj()).optional(),coverCredit:o.Yj().optional(),coverImage:o.bz().refine(e=>!e||e instanceof File&&e.size<=5242880,"Cover image must be less than 5MB").optional(),authors:o.YO(o.Yj()).min(1,"At least one author is required")});function E(e){let{params:t}=e,a=(0,l.useRouter)(),[o,E]=(0,r.useState)(null),[S,R]=(0,r.useState)(!1),[I,A]=(0,r.useState)([]),[k,B]=(0,r.useState)([]),[F,M]=(0,r.useState)([]),[T,V]=(0,r.useState)(!1),[z,P]=(0,r.useState)(null),[D,J]=(0,r.useState)(!1),L=r.use(t).id,Y=(0,i.mN)({resolver:(0,n.u)(N),defaultValues:{title:"",description:"",content:"",status:"DRAFT",category:"",tags:[],coverCredit:"",authors:[]}}),$=Y.watch("description"),_=Y.watch("content");(0,r.useEffect)(()=>{(async()=>{try{V(!0);let e=await fetch("/api/authors");if(!e.ok)throw Error("Failed to fetch authors");let t=await e.json();A(t)}catch(e){console.error("Error fetching authors:",e),E("Failed to load authors. Please try again.")}finally{V(!1)}})(),(async()=>{try{let e=await fetch("/api/categories");if(!e.ok)throw Error("Failed to fetch categories");let t=await e.json();B(t)}catch(e){console.error("Error fetching categories:",e),E("Failed to load categories. Please try again.")}})(),(async()=>{try{let e=await fetch("/api/tags");if(!e.ok)throw Error("Failed to fetch tags");let t=await e.json();M(t)}catch(e){console.error("Error fetching tags:",e),E("Failed to load tags. Please try again.")}})()},[]),(0,r.useEffect)(()=>{(async()=>{try{var e,t,a,s;R(!0);let r=await fetch("/api/publications/".concat(L));if(!r.ok)throw Error("Failed to fetch publication");let l=await r.json();P(l),Y.reset({title:l.title,description:l.description,content:l.content,status:l.status,category:(null==(a=l.categories)||null==(t=a[0])||null==(e=t.category)?void 0:e.id)||"",tags:(null==(s=l.tags)?void 0:s.map(e=>e.tag.id))||[],coverCredit:l.coverCredit||"",authors:l.authors.map(e=>e.profile.id)})}catch(e){console.error("Error fetching publication:",e),E("Failed to load publication. Please try again.")}finally{R(!1)}})()},[L,Y]),(0,r.useEffect)(()=>{var e;if(I.length>0&&(null==(e=Y.getValues("authors"))?void 0:e.length)>0){let e=Y.getValues("authors").filter(e=>I.some(t=>t.id===e));e.length!==Y.getValues("authors").length&&Y.setValue("authors",e,{shouldValidate:!0})}},[I,Y]);let O=async e=>{try{J(!0);let t=await fetch("/api/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!t.ok)throw Error("Failed to create tag");let a=await t.json();M(e=>[...e,a]);let s=new Set(Y.getValues("tags")||[]);s.add(a.id),Y.setValue("tags",Array.from(s),{shouldValidate:!0}),x.oR.success("Tag created successfully")}catch(e){console.error("Error creating tag:",e),x.oR.error("Failed to create tag",{description:"Please try again."})}finally{J(!1)}};async function q(e){try{R(!0),E(null);let t=new FormData;for(let[a,s]of Object.entries(e))"authors"===a?s.forEach(e=>{t.append("authors[]",e)}):"category"===a?t.append("categories[]",s):"tags"===a?s&&Array.isArray(s)&&s.forEach(e=>{t.append("tags[]",e)}):"coverImage"!==a&&t.append(a,s);e.coverImage instanceof File&&t.append("coverImage",e.coverImage);let s=await fetch("/api/publications/".concat(L),{method:"PATCH",body:t});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to update publication")}a.push("/dashboard/publications/".concat(L))}catch(e){E(e instanceof Error?e.message:"An error occurred")}finally{R(!1)}}return S?(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):o||!z?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen gap-4",children:[(0,s.jsx)("p",{className:"text-destructive",children:o||"Publication not found"}),(0,s.jsxs)(m.$,{variant:"outline",onClick:()=>a.push("/dashboard/publications"),children:[(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Back to Publications"]})]}):(0,s.jsxs)("div",{className:"flex flex-col gap-8 p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Publication"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Make changes to your publication here"})]}),(0,s.jsxs)(m.$,{variant:"outline",onClick:()=>a.push("/dashboard/publications/".concat(L)),children:[(0,s.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Back to Details"]})]}),(0,s.jsxs)(w.Zp,{children:[(0,s.jsx)(w.aR,{children:(0,s.jsx)(w.ZB,{children:"Publication Details"})}),(0,s.jsx)(w.Wu,{children:(0,s.jsx)(j.lV,{...Y,children:(0,s.jsxs)("form",{onSubmit:Y.handleSubmit(q),className:"space-y-8",children:[(0,s.jsx)(j.zB,{control:Y.control,name:"title",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Title"}),(0,s.jsx)(j.MJ,{children:(0,s.jsx)(p.p,{placeholder:"Enter title",...t})}),(0,s.jsx)(j.Rr,{children:"The title of your publication. This will be displayed prominently."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"description",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Description"}),(0,s.jsx)(j.MJ,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.T,{placeholder:"Enter description",...t}),(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[(null==$?void 0:$.length)||0,"/500"]})]})}),(0,s.jsx)(j.Rr,{children:"A brief summary of the publication. This will appear in listings and previews."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"content",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Content"}),(0,s.jsx)(j.MJ,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.T,{placeholder:"Enter content",className:"min-h-[200px]",...t}),(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[(null==_?void 0:_.length)||0," characters"]})]})}),(0,s.jsx)(j.Rr,{children:"The main content of your publication. Minimum 50 characters required."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(j.zB,{control:Y.control,name:"status",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Status"}),(0,s.jsxs)(f.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(j.MJ,{children:(0,s.jsx)(f.bq,{children:(0,s.jsx)(f.yv,{placeholder:"Select status"})})}),(0,s.jsxs)(f.gC,{children:[(0,s.jsx)(f.eb,{value:"DRAFT",children:"Draft"}),(0,s.jsx)(f.eb,{value:"PUBLISHED",children:"Published"}),(0,s.jsx)(f.eb,{value:"ARCHIVED",children:"Archived"})]})]}),(0,s.jsx)(j.Rr,{children:"Control the visibility and state of your publication."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"category",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Category"}),(0,s.jsxs)(f.l6,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,s.jsx)(j.MJ,{children:(0,s.jsx)(f.bq,{children:(0,s.jsx)(f.yv,{placeholder:"Select a category"})})}),(0,s.jsx)(f.gC,{children:k.map(e=>(0,s.jsx)(f.eb,{value:e.id,children:e.name},e.id))})]}),(0,s.jsx)(j.Rr,{children:"Select a primary category for your publication."}),(0,s.jsx)(j.C5,{})]})}})]}),(0,s.jsx)(j.zB,{control:Y.control,name:"authors",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Authors"}),(0,s.jsxs)(y.AM,{children:[(0,s.jsx)(y.Wv,{asChild:!0,children:(0,s.jsx)(j.MJ,{children:(0,s.jsxs)(m.$,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[t.value.length>0?"".concat(t.value.length," author").concat(t.value.length>1?"s":""," selected"):"Select authors",(0,s.jsx)(d.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,s.jsx)(y.hl,{className:"w-[400px] p-0",children:(0,s.jsxs)(v.uB,{children:[(0,s.jsx)(v.G7,{placeholder:"Search authors..."}),(0,s.jsxs)(v.oI,{children:[(0,s.jsx)(v.xL,{children:"No authors found."}),(0,s.jsx)(v.L$,{children:I.map(e=>(t.value.includes(e.id),(0,s.jsxs)(v.h_,{onSelect:()=>{let a=new Set(t.value);a.has(e.id)?a.delete(e.id):a.add(e.id),t.onChange(Array.from(a))},className:(0,C.cn)(t.value.includes(e.id)?"bg-secondary":""),children:[(0,s.jsx)(h.A,{className:(0,C.cn)("mr-2 h-4 w-4",t.value.includes(e.id)?"opacity-100":"opacity-0")}),e.firstName," ",e.lastName]},e.id)))})]})]})})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:t.value.map(e=>{let t=I.find(t=>t.id===e);return t?(0,s.jsxs)(b.E,{variant:"secondary",className:"text-sm",children:[t.firstName," ",t.lastName]},t.id):null})}),(0,s.jsx)(j.Rr,{children:"Select one or more authors for this publication."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"coverImage",render:e=>{let{field:{value:t,onChange:a,...r}}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Cover Image"}),(0,s.jsx)(j.MJ,{children:(0,s.jsx)(p.p,{type:"file",accept:"image/*",onChange:e=>{var t;a(null==(t=e.target.files)?void 0:t[0])},...r})}),z.coverImage&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("img",{src:z.coverImage,alt:"Current cover",className:"w-full max-w-[200px] rounded-lg"})}),(0,s.jsx)(j.Rr,{children:"Upload an image (max 5MB). Leave empty to keep current image."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"coverCredit",render:e=>{let{field:t}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Cover Image Credit"}),(0,s.jsx)(j.MJ,{children:(0,s.jsx)(p.p,{placeholder:"Enter cover image credit",...t})}),(0,s.jsx)(j.Rr,{children:"Credit the creator or source of the cover image if applicable."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsx)(j.zB,{control:Y.control,name:"tags",render:e=>{var t,a;let{field:r}=e;return(0,s.jsxs)(j.eI,{children:[(0,s.jsx)(j.lR,{children:"Tags"}),(0,s.jsxs)(y.AM,{children:[(0,s.jsx)(y.Wv,{asChild:!0,children:(0,s.jsx)(j.MJ,{children:(0,s.jsxs)(m.$,{variant:"outline",role:"combobox",className:(0,C.cn)("w-full justify-between",!(null==(t=r.value)?void 0:t.length)&&"text-muted-foreground"),children:[r.value&&r.value.length>0?"".concat(r.value.length," tag").concat(r.value.length>1?"s":""," selected"):"Select tags",(0,s.jsx)(d.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,s.jsx)(y.hl,{className:"w-[400px] p-0",children:(0,s.jsxs)(v.uB,{children:[(0,s.jsx)(v.G7,{placeholder:"Search tags...",onValueChange:e=>{let t=document.getElementById("edit-new-tag-text");t&&(t.textContent=e)}}),(0,s.jsxs)(v.oI,{children:[(0,s.jsx)(v.xL,{children:(0,s.jsxs)(m.$,{variant:"outline",size:"sm",className:"w-full justify-start mt-2",onClick:()=>{let e=document.querySelector("[cmdk-input]"),t=null==e?void 0:e.value;t&&""!==t.trim()&&O(t)},children:[(0,s.jsx)(u.A,{className:"mr-2 h-4 w-4"}),'Create "',(0,s.jsx)("span",{id:"edit-new-tag-text"}),'"']})}),(0,s.jsx)(v.L$,{children:F.map(e=>{var t;return(0,s.jsxs)(v.h_,{onSelect:()=>{let t=new Set(r.value||[]);t.has(e.id)?t.delete(e.id):t.add(e.id),r.onChange(Array.from(t))},children:[(0,s.jsx)(h.A,{className:(0,C.cn)("mr-2 h-4 w-4",(null==(t=r.value)?void 0:t.includes(e.id))?"opacity-100":"opacity-0")}),e.name]},e.id)})})]})]})})]}),(0,s.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:null==(a=r.value)?void 0:a.map(e=>{let t=F.find(t=>t.id===e);return t?(0,s.jsx)(b.E,{variant:"secondary",className:"text-sm",children:t.name},t.id):null})}),(0,s.jsx)(j.Rr,{children:"Select existing tags or type to create new ones for better discoverability."}),(0,s.jsx)(j.C5,{})]})}}),(0,s.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,s.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>a.push("/dashboard/publications/".concat(L)),children:"Cancel"}),(0,s.jsx)(m.$,{type:"submit",disabled:S,children:S?"Saving...":"Save Changes"})]})]})})})]})]})}},96244:(e,t,a)=>{Promise.resolve().then(a.bind(a,89328))}},e=>{var t=t=>e(e.s=t);e.O(0,[9352,652,9764,5521,1859,6671,593,4152,2721,8441,1684,7358],()=>t(96244)),_N_E=e.O()}]);