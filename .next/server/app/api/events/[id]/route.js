"use strict";(()=>{var e={};e.id=9733,e.ids=[9733],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},36463:(e,t,r)=>{r.d(t,{Ay:()=>o});let a=new Map;class n{debug(e,t){this.log("debug",e,t)}info(e,t){this.log("info",e,t)}warn(e,t){this.log("warn",e,t)}error(e,t,r){let a={...r,errorName:t?.name};this.log("error",e,a,t?.stack),this.saveErrorToDatabase("medium",e,a,t?.stack)}fatal(e,t,r){let a={...r,errorName:t?.name};this.log("fatal",e,a,t?.stack),this.saveErrorToDatabase("critical",e,a,t?.stack)}log(e,t,r,n){new Date().toISOString();let o=`${e}:${t}`,i=Date.now();if(i-(a.get(o)||0)<1e3)return;a.set(o,i);let s=`[${e.toUpperCase()}] ${t}`;switch(r&&(s+=` ${JSON.stringify(r)}`),e){case"debug":console.debug(s);break;case"info":console.info(s);break;case"warn":console.warn(s);break;case"error":case"fatal":console.error(s),n&&console.error(n)}}async saveErrorToDatabase(e,t,a,n){try{let{default:o}=await Promise.resolve().then(r.bind(r,34747));await o.run(`
        INSERT INTO error_logs (
          userId, severity, message, context, stack, timestamp
        ) VALUES (?, ?, ?, ?, ?, ?)
      `,[a?.userId||null,e,t,JSON.stringify(a||{}),n||null,new Date().toISOString()])}catch(e){console.error("Failed to save error log to database:",e)}}}let o=new n},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},46412:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>y,serverHooks:()=>E,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{DELETE:()=>f,GET:()=>c,PATCH:()=>p});var n=r(96559),o=r(48088),i=r(37719),s=r(34747),d=r(51364),l=r(23607),u=r(36463);async function c(e,{params:t}){try{let e=await (0,d.Mt)();if(!e?.user)return l.aI.unauthorized();let r=await s.default.get(`SELECT e.*, c.name as categoryName 
       FROM events e
       LEFT JOIN event_categories c ON e.categoryId = c.id
       WHERE e.id = ?`,[t.id]);if(!r)return l.aI.notFound("Event not found");let a=await s.default.all(`SELECT s.*, es.role, es.displayOrder
       FROM speakers s
       JOIN event_speakers es ON s.id = es.speakerId
       WHERE es.eventId = ?
       ORDER BY es.displayOrder ASC`,[t.id]),n=await s.default.all(`SELECT t.*
       FROM tags t
       JOIN tags_on_events te ON t.id = te.tagId
       WHERE te.eventId = ?
       ORDER BY t.name ASC`,[t.id]),o=await s.default.all(`SELECT p.*, s.firstName, s.lastName, s.organization
       FROM presentation p
       JOIN speakers s ON p.speakerId = s.id
       WHERE p.eventId = ?
       ORDER BY p.startTime ASC`,[t.id]);return l.aI.success({...r,speakers:a,tags:n,presentations:o})}catch(e){return u.Ay.error("Failed to fetch event",e instanceof Error?e:Error(String(e))),l.aI.error("Failed to fetch event")}}async function p(e,{params:t}){try{let r=await (0,d.Mt)();if(!r?.user)return l.aI.unauthorized();if(!await s.default.get("SELECT id FROM events WHERE id = ?",[t.id]))return l.aI.notFound("Event not found");let{title:a,description:n,location:o,startDate:i,endDate:u,categoryId:c,status:p,published:f}=await e.json();if(!a)return l.aI.badRequest("Title is required");if(!n)return l.aI.badRequest("Description is required");if(!o)return l.aI.badRequest("Location is required");let y=null;if(a&&(y=a.toLowerCase().replace(/[^a-z0-9]+/g,"-"),await s.default.get("SELECT id FROM events WHERE slug = ? AND id != ?",[y,t.id])))return l.aI.badRequest("An event with this title already exists");let h=new Date().toISOString();return await s.default.transaction(async()=>{let e=[],r=[];a&&(e.push("title = ?"),r.push(a)),y&&(e.push("slug = ?"),r.push(y)),n&&(e.push("description = ?"),r.push(n)),o&&(e.push("location = ?"),r.push(o)),i&&(e.push("startDate = ?"),r.push(new Date(i).toISOString())),u&&(e.push("endDate = ?"),r.push(new Date(u).toISOString())),p&&(e.push("status = ?"),r.push(p)),void 0!==f&&(e.push("published = ?"),r.push(+!!f)),void 0!==c&&(e.push("categoryId = ?"),r.push(c||null)),e.push("updatedAt = ?"),r.push(h),r.push(t.id),await s.default.run(`UPDATE events SET ${e.join(", ")} WHERE id = ?`,r);let d=await s.default.get(`SELECT e.*, c.name as categoryName 
         FROM events e
         LEFT JOIN event_categories c ON e.categoryId = c.id
         WHERE e.id = ?`,[t.id]);return l.aI.success(d)})}catch(e){return u.Ay.error("Failed to update event",e instanceof Error?e:Error(String(e))),l.aI.error("Failed to update event")}}async function f(e,{params:t}){try{let e=await (0,d.Mt)();if(!e?.user)return l.aI.unauthorized();if(!await s.default.get("SELECT id FROM events WHERE id = ?",[t.id]))return l.aI.notFound("Event not found");return await s.default.transaction(async()=>(await s.default.run("DELETE FROM tags_on_events WHERE eventId = ?",[t.id]),await s.default.run("DELETE FROM event_speakers WHERE eventId = ?",[t.id]),await s.default.run("DELETE FROM presentation WHERE eventId = ?",[t.id]),await s.default.run("DELETE FROM events WHERE id = ?",[t.id]),l.aI.noContent()))}catch(e){return u.Ay.error("Failed to delete event",e instanceof Error?e:Error(String(e))),l.aI.error("Failed to delete event")}}let y=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/events/[id]/route",pathname:"/api/events/[id]",filename:"route",bundlePath:"app/api/events/[id]/route"},resolvedPagePath:"/Users/pro/Dev/gmp/src/app/api/events/[id]/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:E}=y;function g(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},51364:(e,t,r)=>{r.d(t,{Mt:()=>I});var a=r(44999),n=r(21187),o=r(16263),i=r(92120),s=r(4208);let d=async(e,t,r,a)=>{let n=await (0,s.A)(e,t,"verify");(0,i.A)(e,n);let d=(0,o.A)(e,n.algorithm);try{return await crypto.subtle.verify(d,n,r,a)}catch{return!1}};var l=r(70803),u=r(97989),c=r(74996),p=r(89531),f=r(44032),y=r(41286);let h=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var w=r(95548);async function E(e,t,r){let a,o;if(!(0,p.A)(e))throw new l.Ye("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new l.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new l.Ye("JWS Protected Header incorrect type");if(void 0===e.payload)throw new l.Ye("JWS Payload missing");if("string"!=typeof e.signature)throw new l.Ye("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,p.A)(e.header))throw new l.Ye("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=(0,n.D)(e.protected);i=JSON.parse(u.D0.decode(t))}catch{throw new l.Ye("JWS Protected Header is invalid")}if(!(0,c.A)(i,e.header))throw new l.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...i,...e.header},E=(0,y.A)(l.Ye,new Map([["b64",!0]]),r?.crit,i,s),g=!0;if(E.has("b64")&&"boolean"!=typeof(g=i.b64))throw new l.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:v}=s;if("string"!=typeof v||!v)throw new l.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let m=r&&h("algorithms",r.algorithms);if(m&&!m.has(v))throw new l.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(g){if("string"!=typeof e.payload)throw new l.Ye("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new l.Ye("JWS Payload must be a string or an Uint8Array instance");let S=!1;"function"==typeof t&&(t=await t(i,e),S=!0),(0,f.A)(v,t,"verify");let R=(0,u.xW)(u.Rd.encode(e.protected??""),u.Rd.encode("."),"string"==typeof e.payload?u.Rd.encode(e.payload):e.payload);try{a=(0,n.D)(e.signature)}catch{throw new l.Ye("Failed to base64url decode the signature")}let I=await (0,w.A)(t,v);if(!await d(v,I,a,R))throw new l.h2;if(g)try{o=(0,n.D)(e.payload)}catch{throw new l.Ye("Failed to base64url decode the payload")}else o="string"==typeof e.payload?u.Rd.encode(e.payload):e.payload;let b={payload:o};return(void 0!==e.protected&&(b.protectedHeader=i),void 0!==e.header&&(b.unprotectedHeader=e.header),S)?{...b,key:I}:b}async function g(e,t,r){if(e instanceof Uint8Array&&(e=u.D0.decode(e)),"string"!=typeof e)throw new l.Ye("Compact JWS must be a string or Uint8Array");let{0:a,1:n,2:o,length:i}=e.split(".");if(3!==i)throw new l.Ye("Invalid Compact JWS");let s=await E({payload:n,protected:a,signature:o},t,r),d={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?{...d,key:s.key}:d}var v=r(91492);async function m(e,t,r){let a=await g(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new l.Dp("JWTs MUST NOT use unencoded payload");let n={payload:(0,v.k)(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...n,key:a.key}:n}let S=new TextEncoder().encode(process.env.JWT_SECRET||"test_jwt_secret_for_development_only");async function R(){try{let e=await (0,a.UL)(),t=e.get("token")?.value;if(!t)return null;return(await m(t,S)).payload}catch(e){return console.error("Auth error:",e),null}}async function I(){try{let e=await R();if(!e)return null;return{user:{id:e.id,email:e.email,role:e.role}}}catch(e){return console.error("Failed to get server session:",e),null}}},55511:e=>{e.exports=require("crypto")},56689:e=>{e.exports=require("sqlite3")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,4999,4314,635],()=>r(46412));module.exports=a})();