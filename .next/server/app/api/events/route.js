"use strict";(()=>{var e={};e.id=8301,e.ids=[8301],e.modules={3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51364:(e,t,r)=>{r.d(t,{Mt:()=>S});var a=r(44999),n=r(21187),i=r(16263),o=r(92120),s=r(4208);let d=async(e,t,r,a)=>{let n=await (0,s.A)(e,t,"verify");(0,o.A)(e,n);let d=(0,i.A)(e,n.algorithm);try{return await crypto.subtle.verify(d,n,r,a)}catch{return!1}};var u=r(70803),l=r(97989),c=r(74996),p=r(89531),f=r(44032),h=r(41286);let w=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};var y=r(95548);async function E(e,t,r){let a,i;if(!(0,p.A)(e))throw new u.Ye("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new u.Ye('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new u.Ye("JWS Protected Header incorrect type");if(void 0===e.payload)throw new u.Ye("JWS Payload missing");if("string"!=typeof e.signature)throw new u.Ye("JWS Signature missing or incorrect type");if(void 0!==e.header&&!(0,p.A)(e.header))throw new u.Ye("JWS Unprotected Header incorrect type");let o={};if(e.protected)try{let t=(0,n.D)(e.protected);o=JSON.parse(l.D0.decode(t))}catch{throw new u.Ye("JWS Protected Header is invalid")}if(!(0,c.A)(o,e.header))throw new u.Ye("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...o,...e.header},E=(0,h.A)(u.Ye,new Map([["b64",!0]]),r?.crit,o,s),g=!0;if(E.has("b64")&&"boolean"!=typeof(g=o.b64))throw new u.Ye('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:v}=s;if("string"!=typeof v||!v)throw new u.Ye('JWS "alg" (Algorithm) Header Parameter missing or invalid');let I=r&&w("algorithms",r.algorithms);if(I&&!I.has(v))throw new u.Rb('"alg" (Algorithm) Header Parameter value not allowed');if(g){if("string"!=typeof e.payload)throw new u.Ye("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new u.Ye("JWS Payload must be a string or an Uint8Array instance");let R=!1;"function"==typeof t&&(t=await t(o,e),R=!0),(0,f.A)(v,t,"verify");let m=(0,l.xW)(l.Rd.encode(e.protected??""),l.Rd.encode("."),"string"==typeof e.payload?l.Rd.encode(e.payload):e.payload);try{a=(0,n.D)(e.signature)}catch{throw new u.Ye("Failed to base64url decode the signature")}let S=await (0,y.A)(t,v);if(!await d(v,S,a,m))throw new u.h2;if(g)try{i=(0,n.D)(e.payload)}catch{throw new u.Ye("Failed to base64url decode the payload")}else i="string"==typeof e.payload?l.Rd.encode(e.payload):e.payload;let b={payload:i};return(void 0!==e.protected&&(b.protectedHeader=o),void 0!==e.header&&(b.unprotectedHeader=e.header),R)?{...b,key:S}:b}async function g(e,t,r){if(e instanceof Uint8Array&&(e=l.D0.decode(e)),"string"!=typeof e)throw new u.Ye("Compact JWS must be a string or Uint8Array");let{0:a,1:n,2:i,length:o}=e.split(".");if(3!==o)throw new u.Ye("Invalid Compact JWS");let s=await E({payload:n,protected:a,signature:i},t,r),d={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?{...d,key:s.key}:d}var v=r(91492);async function I(e,t,r){let a=await g(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new u.Dp("JWTs MUST NOT use unencoded payload");let n={payload:(0,v.k)(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...n,key:a.key}:n}let R=new TextEncoder().encode(process.env.JWT_SECRET||"test_jwt_secret_for_development_only");async function m(){try{let e=await (0,a.UL)(),t=e.get("token")?.value;if(!t)return null;return(await I(t,R)).payload}catch(e){return console.error("Auth error:",e),null}}async function S(){try{let e=await m();if(!e)return null;return{user:{id:e.id,email:e.email,role:e.role}}}catch(e){return console.error("Failed to get server session:",e),null}}},55511:e=>{e.exports=require("crypto")},56689:e=>{e.exports=require("sqlite3")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},90355:(e,t,r)=>{r.r(t),r.d(t,{patchFetch:()=>g,routeModule:()=>h,serverHooks:()=>E,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>y});var a={};r.r(a),r.d(a,{DELETE:()=>f,GET:()=>l,PATCH:()=>p,POST:()=>c});var n=r(96559),i=r(48088),o=r(37719),s=r(34747),d=r(51364),u=r(23607);async function l(e){try{let t=await (0,d.Mt)();if(!t?.user)return u.aI.unauthorized();let r=new URL(e.url).searchParams,a=parseInt(r.get("page")||"1"),n=parseInt(r.get("limit")||"10"),i=r.get("search")||"",{offset:o}=await s.default.paginate(a,n),l=[],c="";i&&(c=" WHERE title LIKE ? OR description LIKE ?",l=[`%${i}%`,`%${i}%`]);let p=await s.default.get("SELECT COUNT(*) as total FROM events"+c,l),f=p?.total||0,h=`
      SELECT e.*, c.name as categoryName
      FROM events e
      LEFT JOIN event_categories c ON e.categoryId = c.id
    `,w=[];i&&(h+=" WHERE e.title LIKE ? OR e.description LIKE ?",w=[`%${i}%`,`%${i}%`]),h+=" ORDER BY e.startDate DESC LIMIT ? OFFSET ?",w.push(n,o);let y=await s.default.all(h,w);return u.aI.success(y,{total:f,page:a,limit:n,totalPages:Math.ceil(f/n)})}catch(e){return console.error("Failed to fetch events:",e),u.aI.error("Failed to fetch events")}}async function c(e){try{let t=await (0,d.Mt)();if(!t?.user)return u.aI.unauthorized();let{title:r,description:a,location:n,startDate:i,endDate:o,categoryId:l}=await e.json();if(!r)return u.aI.badRequest("Title is required");if(!a)return u.aI.badRequest("Description is required");if(!n)return u.aI.badRequest("Location is required");if(!i)return u.aI.badRequest("Start date is required");if(!o)return u.aI.badRequest("End date is required");let c=r.toLowerCase().replace(/[^a-z0-9]+/g,"-");if(await s.default.get("SELECT id FROM events WHERE slug = ?",[c]))return u.aI.badRequest("An event with this title already exists");let p=new Date().toISOString(),f=await s.default.generateId();return await s.default.transaction(async()=>{await s.default.run(`INSERT INTO events (
          id, title, slug, description, location, startDate, endDate, 
          status, published, categoryId, createdAt, updatedAt
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[f,r,c,a,n,new Date(i).toISOString(),new Date(o).toISOString(),"DRAFT",0,l||null,p,p]);let e=await s.default.get(`SELECT e.*, c.name as categoryName 
         FROM events e
         LEFT JOIN event_categories c ON e.categoryId = c.id
         WHERE e.id = ?`,[f]);return u.aI.created(e)})}catch(e){return console.error("Failed to create event:",e),u.aI.error("Failed to create event")}}async function p(e,{params:t}){try{let t=await (0,d.Mt)();if(!t?.user)return u.aI.unauthorized();let r=new URL(e.url).pathname.split("/"),a=r[r.length-1];if(!a)return u.aI.badRequest("Event ID is required");if(!await s.default.get("SELECT id FROM events WHERE id = ?",[a]))return u.aI.notFound("Event not found");let{title:n,description:i,location:o,startDate:l,endDate:c,categoryId:p,status:f,published:h}=await e.json();if(!n)return u.aI.badRequest("Title is required");if(!i)return u.aI.badRequest("Description is required");if(!o)return u.aI.badRequest("Location is required");let w=null;if(n&&(w=n.toLowerCase().replace(/[^a-z0-9]+/g,"-"),await s.default.get("SELECT id FROM events WHERE slug = ? AND id != ?",[w,a])))return u.aI.badRequest("An event with this title already exists");let y=new Date().toISOString();return await s.default.transaction(async()=>{let e=[],t=[];n&&(e.push("title = ?"),t.push(n)),w&&(e.push("slug = ?"),t.push(w)),i&&(e.push("description = ?"),t.push(i)),o&&(e.push("location = ?"),t.push(o)),l&&(e.push("startDate = ?"),t.push(new Date(l).toISOString())),c&&(e.push("endDate = ?"),t.push(new Date(c).toISOString())),f&&(e.push("status = ?"),t.push(f)),void 0!==h&&(e.push("published = ?"),t.push(+!!h)),void 0!==p&&(e.push("categoryId = ?"),t.push(p||null)),e.push("updatedAt = ?"),t.push(y),t.push(a),await s.default.run(`UPDATE events SET ${e.join(", ")} WHERE id = ?`,t);let r=await s.default.get(`SELECT e.*, c.name as categoryName 
         FROM events e
         LEFT JOIN event_categories c ON e.categoryId = c.id
         WHERE e.id = ?`,[a]);return u.aI.success(r)})}catch(e){return console.error("Failed to update event:",e),u.aI.error("Failed to update event")}}async function f(e){try{let t=await (0,d.Mt)();if(!t?.user)return u.aI.unauthorized();let r=new URL(e.url).pathname.split("/"),a=r[r.length-1];if(!a)return u.aI.badRequest("Event ID is required");if(!await s.default.get("SELECT id FROM events WHERE id = ?",[a]))return u.aI.notFound("Event not found");return await s.default.transaction(async()=>(await s.default.run("DELETE FROM tags_on_events WHERE eventId = ?",[a]),await s.default.run("DELETE FROM event_speakers WHERE eventId = ?",[a]),await s.default.run("DELETE FROM presentation WHERE eventId = ?",[a]),await s.default.run("DELETE FROM events WHERE id = ?",[a]),u.aI.noContent()))}catch(e){return console.error("Failed to delete event:",e),u.aI.error("Failed to delete event")}}let h=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"/Users/pro/Dev/gmp/src/app/api/events/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:y,serverHooks:E}=h;function g(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:y})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[4447,580,4999,4314,635],()=>r(90355));module.exports=a})();