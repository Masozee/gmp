(()=>{var e={};e.id=9838,e.ids=[9838],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29564:(e,t,s)=>{Promise.resolve().then(s.bind(s,70268))},33873:e=>{"use strict";e.exports=require("path")},35657:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,pages:()=>c,routeModule:()=>u,tree:()=>d});var r=s(65239),a=s(48088),i=s(88170),n=s.n(i),l=s(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d={children:["",{children:["dashboard",{children:["publications",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,86414)),"/Users/pro/Dev/gmp/src/app/dashboard/publications/[id]/edit/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,63144)),"/Users/pro/Dev/gmp/src/app/dashboard/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(s.bind(s,61137)),"/Users/pro/Dev/gmp/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(s.t.bind(s,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(s.t.bind(s,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(s.bind(s,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/pro/Dev/gmp/src/app/dashboard/publications/[id]/edit/page.tsx"],h={require:s,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/publications/[id]/edit/page",pathname:"/dashboard/publications/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},40988:(e,t,s)=>{"use strict";s.d(t,{AM:()=>l,Wv:()=>o,hl:()=>d});var r=s(60687),a=s(43210),i=s(40599),n=s(4780);let l=i.bL,o=i.l9;i.Mz;let d=a.forwardRef(({className:e,align:t="center",sideOffset:s=4,...a},l)=>(0,r.jsx)(i.ZL,{children:(0,r.jsx)(i.UC,{ref:l,align:t,sideOffset:s,className:(0,n.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));d.displayName=i.UC.displayName},55817:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(82614).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70268:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>S});var r=s(60687),a=s(43210),i=s.n(a),n=s(16189),l=s(27605),o=s(63442),d=s(45880),c=s(55817),h=s(38485),u=s(58450),p=s(54052),x=s(52581),m=s(29523),j=s(71669),g=s(89667),f=s(34729),v=s(15079),b=s(41784),y=s(40988),C=s(96834),w=s(44493),N=s(4780);let A=d.Ik({title:d.Yj().min(3,"Title must be at least 3 characters").max(100,"Title must be less than 100 characters"),description:d.Yj().min(10,"Description must be at least 10 characters").max(500,"Description must be less than 500 characters"),content:d.Yj().min(50,"Content must be at least 50 characters"),status:d.k5(["DRAFT","PUBLISHED","ARCHIVED"],{required_error:"Please select a status"}),category:d.Yj().min(1,"Category is required"),tags:d.YO(d.Yj()).optional(),coverCredit:d.Yj().optional(),coverImage:d.bz().refine(e=>!e||e instanceof File&&e.size<=5242880,"Cover image must be less than 5MB").optional(),authors:d.YO(d.Yj()).min(1,"At least one author is required")});function S({params:e}){let t=(0,n.useRouter)(),[s,d]=(0,a.useState)(null),[S,R]=(0,a.useState)(!1),[P,I]=(0,a.useState)([]),[k,E]=(0,a.useState)([]),[M,D]=(0,a.useState)([]),[z,B]=(0,a.useState)(!1),[T,_]=(0,a.useState)(null),[$,q]=(0,a.useState)(!1),V=i().use(e).id,L=(0,l.mN)({resolver:(0,o.u)(A),defaultValues:{title:"",description:"",content:"",status:"DRAFT",category:"",tags:[],coverCredit:"",authors:[]}}),U=L.watch("description"),J=L.watch("content"),F=async e=>{try{q(!0);let t=await fetch("/api/tags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e})});if(!t.ok)throw Error("Failed to create tag");let s=await t.json();D(e=>[...e,s]);let r=new Set(L.getValues("tags")||[]);r.add(s.id),L.setValue("tags",Array.from(r),{shouldValidate:!0}),x.oR.success("Tag created successfully")}catch(e){console.error("Error creating tag:",e),x.oR.error("Failed to create tag",{description:"Please try again."})}finally{q(!1)}};async function Y(e){try{R(!0),d(null);let s=new FormData;for(let[t,r]of Object.entries(e))"authors"===t?r.forEach(e=>{s.append("authors[]",e)}):"category"===t?s.append("categories[]",r):"tags"===t?r&&Array.isArray(r)&&r.forEach(e=>{s.append("tags[]",e)}):"coverImage"!==t&&s.append(t,r);e.coverImage instanceof File&&s.append("coverImage",e.coverImage);let r=await fetch(`/api/publications/${V}`,{method:"PATCH",body:s});if(!r.ok){let e=await r.json();throw Error(e.error||"Failed to update publication")}t.push(`/dashboard/publications/${V}`)}catch(e){d(e instanceof Error?e.message:"An error occurred")}finally{R(!1)}}return S?(0,r.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"Loading..."})}):s||!T?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-screen gap-4",children:[(0,r.jsx)("p",{className:"text-destructive",children:s||"Publication not found"}),(0,r.jsxs)(m.$,{variant:"outline",onClick:()=>t.push("/dashboard/publications"),children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Back to Publications"]})]}):(0,r.jsxs)("div",{className:"flex flex-col gap-8 p-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Edit Publication"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Make changes to your publication here"})]}),(0,r.jsxs)(m.$,{variant:"outline",onClick:()=>t.push(`/dashboard/publications/${V}`),children:[(0,r.jsx)(c.A,{className:"mr-2 h-4 w-4"}),"Back to Details"]})]}),(0,r.jsxs)(w.Zp,{children:[(0,r.jsx)(w.aR,{children:(0,r.jsx)(w.ZB,{children:"Publication Details"})}),(0,r.jsx)(w.Wu,{children:(0,r.jsx)(j.lV,{...L,children:(0,r.jsxs)("form",{onSubmit:L.handleSubmit(Y),className:"space-y-8",children:[(0,r.jsx)(j.zB,{control:L.control,name:"title",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Title"}),(0,r.jsx)(j.MJ,{children:(0,r.jsx)(g.p,{placeholder:"Enter title",...e})}),(0,r.jsx)(j.Rr,{children:"The title of your publication. This will be displayed prominently."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"description",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Description"}),(0,r.jsx)(j.MJ,{children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f.T,{placeholder:"Enter description",...e}),(0,r.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[U?.length||0,"/500"]})]})}),(0,r.jsx)(j.Rr,{children:"A brief summary of the publication. This will appear in listings and previews."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"content",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Content"}),(0,r.jsx)(j.MJ,{children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(f.T,{placeholder:"Enter content",className:"min-h-[200px]",...e}),(0,r.jsxs)("div",{className:"absolute bottom-2 right-2 text-xs text-muted-foreground",children:[J?.length||0," characters"]})]})}),(0,r.jsx)(j.Rr,{children:"The main content of your publication. Minimum 50 characters required."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(j.zB,{control:L.control,name:"status",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Status"}),(0,r.jsxs)(v.l6,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,r.jsx)(j.MJ,{children:(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select status"})})}),(0,r.jsxs)(v.gC,{children:[(0,r.jsx)(v.eb,{value:"DRAFT",children:"Draft"}),(0,r.jsx)(v.eb,{value:"PUBLISHED",children:"Published"}),(0,r.jsx)(v.eb,{value:"ARCHIVED",children:"Archived"})]})]}),(0,r.jsx)(j.Rr,{children:"Control the visibility and state of your publication."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"category",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Category"}),(0,r.jsxs)(v.l6,{onValueChange:e.onChange,defaultValue:e.value,children:[(0,r.jsx)(j.MJ,{children:(0,r.jsx)(v.bq,{children:(0,r.jsx)(v.yv,{placeholder:"Select a category"})})}),(0,r.jsx)(v.gC,{children:k.map(e=>(0,r.jsx)(v.eb,{value:e.id,children:e.name},e.id))})]}),(0,r.jsx)(j.Rr,{children:"Select a primary category for your publication."}),(0,r.jsx)(j.C5,{})]})})]}),(0,r.jsx)(j.zB,{control:L.control,name:"authors",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Authors"}),(0,r.jsxs)(y.AM,{children:[(0,r.jsx)(y.Wv,{asChild:!0,children:(0,r.jsx)(j.MJ,{children:(0,r.jsxs)(m.$,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[e.value.length>0?`${e.value.length} author${e.value.length>1?"s":""} selected`:"Select authors",(0,r.jsx)(h.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,r.jsx)(y.hl,{className:"w-[400px] p-0",children:(0,r.jsxs)(b.uB,{children:[(0,r.jsx)(b.G7,{placeholder:"Search authors..."}),(0,r.jsxs)(b.oI,{children:[(0,r.jsx)(b.xL,{children:"No authors found."}),(0,r.jsx)(b.L$,{children:P.map(t=>(e.value.includes(t.id),(0,r.jsxs)(b.h_,{onSelect:()=>{let s=new Set(e.value);s.has(t.id)?s.delete(t.id):s.add(t.id),e.onChange(Array.from(s))},className:(0,N.cn)(e.value.includes(t.id)?"bg-secondary":""),children:[(0,r.jsx)(u.A,{className:(0,N.cn)("mr-2 h-4 w-4",e.value.includes(t.id)?"opacity-100":"opacity-0")}),t.firstName," ",t.lastName]},t.id)))})]})]})})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.value.map(e=>{let t=P.find(t=>t.id===e);return t?(0,r.jsxs)(C.E,{variant:"secondary",className:"text-sm",children:[t.firstName," ",t.lastName]},t.id):null})}),(0,r.jsx)(j.Rr,{children:"Select one or more authors for this publication."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"coverImage",render:({field:{value:e,onChange:t,...s}})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Cover Image"}),(0,r.jsx)(j.MJ,{children:(0,r.jsx)(g.p,{type:"file",accept:"image/*",onChange:e=>{t(e.target.files?.[0])},...s})}),T.coverImage&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("img",{src:T.coverImage,alt:"Current cover",className:"w-full max-w-[200px] rounded-lg"})}),(0,r.jsx)(j.Rr,{children:"Upload an image (max 5MB). Leave empty to keep current image."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"coverCredit",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Cover Image Credit"}),(0,r.jsx)(j.MJ,{children:(0,r.jsx)(g.p,{placeholder:"Enter cover image credit",...e})}),(0,r.jsx)(j.Rr,{children:"Credit the creator or source of the cover image if applicable."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsx)(j.zB,{control:L.control,name:"tags",render:({field:e})=>(0,r.jsxs)(j.eI,{children:[(0,r.jsx)(j.lR,{children:"Tags"}),(0,r.jsxs)(y.AM,{children:[(0,r.jsx)(y.Wv,{asChild:!0,children:(0,r.jsx)(j.MJ,{children:(0,r.jsxs)(m.$,{variant:"outline",role:"combobox",className:(0,N.cn)("w-full justify-between",!e.value?.length&&"text-muted-foreground"),children:[e.value&&e.value.length>0?`${e.value.length} tag${e.value.length>1?"s":""} selected`:"Select tags",(0,r.jsx)(h.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),(0,r.jsx)(y.hl,{className:"w-[400px] p-0",children:(0,r.jsxs)(b.uB,{children:[(0,r.jsx)(b.G7,{placeholder:"Search tags...",onValueChange:e=>{let t=document.getElementById("edit-new-tag-text");t&&(t.textContent=e)}}),(0,r.jsxs)(b.oI,{children:[(0,r.jsx)(b.xL,{children:(0,r.jsxs)(m.$,{variant:"outline",size:"sm",className:"w-full justify-start mt-2",onClick:()=>{let e=document.querySelector("[cmdk-input]"),t=e?.value;t&&""!==t.trim()&&F(t)},children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4"}),'Create "',(0,r.jsx)("span",{id:"edit-new-tag-text"}),'"']})}),(0,r.jsx)(b.L$,{children:M.map(t=>(0,r.jsxs)(b.h_,{onSelect:()=>{let s=new Set(e.value||[]);s.has(t.id)?s.delete(t.id):s.add(t.id),e.onChange(Array.from(s))},children:[(0,r.jsx)(u.A,{className:(0,N.cn)("mr-2 h-4 w-4",e.value?.includes(t.id)?"opacity-100":"opacity-0")}),t.name]},t.id))})]})]})})]}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.value?.map(e=>{let t=M.find(t=>t.id===e);return t?(0,r.jsx)(C.E,{variant:"secondary",className:"text-sm",children:t.name},t.id):null})}),(0,r.jsx)(j.Rr,{children:"Select existing tags or type to create new ones for better discoverability."}),(0,r.jsx)(j.C5,{})]})}),(0,r.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,r.jsx)(m.$,{type:"button",variant:"outline",onClick:()=>t.push(`/dashboard/publications/${V}`),children:"Cancel"}),(0,r.jsx)(m.$,{type:"submit",disabled:S,children:S?"Saving...":"Save Changes"})]})]})})})]})]})}},71420:(e,t,s)=>{Promise.resolve().then(s.bind(s,86414))},79551:e=>{"use strict";e.exports=require("url")},86414:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/pro/Dev/gmp/src/app/dashboard/publications/[id]/edit/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/pro/Dev/gmp/src/app/dashboard/publications/[id]/edit/page.tsx","default")}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[4447,163,5767,7210,6460,8749,9882,1758,2729,1726,6282,4030,3483],()=>s(35657));module.exports=r})();